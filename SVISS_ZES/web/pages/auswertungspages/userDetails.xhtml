<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<ui:composition template="/pages/auswertung.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">

    <ui:param name="currentAuswertungsIndex" value="1" />

    <ui:define name="auswertung">
        <h:form>



            <p:growl autoUpdate="true"/>

            <h1 align="center">Auswertung: User Details</h1>
            <p:panelGrid columns="4">
            <p:selectOneMenu id="selectUser" value="#{userDetailsBean.selectedUser}">
                <f:selectItems value="#{userDetailsBean.userAsStringList}"/>
                <p:ajax update="selectedYear selectedDate"/>
            </p:selectOneMenu>

            <p:selectOneMenu id="selectedYear" value="#{userDetailsBean.selectedYear}">
                <f:selectItems value="#{userDetailsBean.years}"/>
                <p:ajax update="selectedDate"/>
            </p:selectOneMenu>

            <p:selectOneMenu id="selectedDate" value="#{userDetailsBean.selectedDate}" converter="localDateConverter">
                <f:selectItems value="#{userDetailsBean.dates}" var="date" itemLabel="#{date.label}" itemValue="#{date.value}"/>
            </p:selectOneMenu>


            <p:commandButton value="load" actionListener="#{userDetailsBean.loadMonthOverview}" update="timeDataTable"/>
            </p:panelGrid>

            <p:dataTable id="timeDataTable" value="#{userDetailsBean.timerowlist}" var="entry" resizableColumns="true" liveResize="true" style="text-align: center">

                <p:column headerText="Date" width="7%" >
                    <p:outputLabel value="#{entry.date}"/>
                </p:column>

                <p:column headerText="Beginn" width="7%">
                    <p:outputLabel value="#{entry.workTimeStart}"/>
                </p:column>

                <p:column headerText="Ende" width="8%">
                    <p:outputLabel value="#{entry.workTimeEnd}"/>
                </p:column>

                <p:column headerText="Pause" width="5%">
                    <p:outputLabel value="#{entry.breakTime}"/>
                </p:column>

                <p:column headerText="Sollarbeitszeit" width="10%">
                    <p:outputLabel value="#{entry.sollZeit}"/>
                </p:column>

                <p:column headerText="Istarbeitszeit" width="10%">
                    <p:outputLabel value="#{entry.workTime}"/>

                    <f:facet name="footer">
                        <p:outputLabel value="Saldo: #{userDetailsBean.plusOrMinus}#{userDetailsBean.saldo}"/>
                    </f:facet>
                </p:column>

                <p:column headerText="Überstunden nach 19 Uhr" width="15%">
                    <p:outputLabel value="#{entry.overTime19plus}"/>

                    <f:facet name="footer">
                        <p:outputLabel value="Gesamt: #{userDetailsBean.überstundenNach19}"/>
                    </f:facet>
                </p:column>

                <p:column headerText="Bemerkungen">
                    <p:outputLabel value="#{entry.reason}"/>

                    <f:facet name="footer">
                        <p:outputLabel value="Verbleibender Urlaub am Ende des Monats: #{userDetailsBean.urlaubsanspruch} Tage"/>
                    </f:facet>
                </p:column>


                <f:facet name="footer">
                    <p:commandLink ajax="false">
                        <p:graphicImage name="/images/excel-icon.png" style="width: 3%"/>
                        <p:dataExporter   type="XLS" target="timeDataTable" fileName="Zeiten" encoding="iso-8859-1"/>

                    </p:commandLink>
                    <p:commandLink ajax="false">
                        <p:graphicImage name="/images/pdf-icon.png" style="width: 3%"/>
                        <p:dataExporter type="PDF" target="timeDataTable" fileName="Zeiten" encoding="iso-8859-1" preProcessor="#{userDetailsBean.preProcessPDF}" />
                    </p:commandLink>
                </f:facet>

            </p:dataTable>


            <p:remoteCommand update="selectUser selectedYear selectedDate timeDataTable" action="#{userDetailsBean.reloadUsers}" autoRun="true"/>
        </h:form>
    </ui:define>



</ui:composition>
