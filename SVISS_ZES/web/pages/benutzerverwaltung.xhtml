<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<ui:composition template="/pages/mainSite.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">


    <ui:define name="content">
        <h:form id="tableForm">
            <p:dataTable id="usertable" var="user" value="#{benutzerverwaltungsBean.userList}">

                <p:column headerText="Username">
                    <h:outputText value="#{user.username}"/>
                </p:column>

                <p:column headerText="Name">
                    <h:outputText value="#{user.persName}"/>
                </p:column>

                <p:column headerText="Berechtigungsstufe">
                    <h:outputText value="#{user.accessLevel}">
                        <f:converter converterId="accesslevelconv"/>
                    </h:outputText>
                </p:column>

                <p:column headerText="E-Mail-Adresse">
                    <h:outputText value="#{user.email}"/>
                </p:column>

                <p:column headerText="Overtime Left">
                    <h:outputText value="#{user.overTimeLeft}">
                        <f:converter converterId="minuteHourConverter"/>
                    </h:outputText>
                </p:column>

                <p:column headerText="Vacation Left">
                    <h:outputText value="#{user.vacationLeft}"/>
                </p:column>

                <p:column headerText="WeekTime">
                    <h:outputText value="#{user.weekTime}"/>
                </p:column>

                <p:column headerText="Enabled">
                    <h:outputText value="#{user.disabledString}"/>
                </p:column>

                <p:column headerText="User ändern">
                    <p:commandButton id="editUserBut" value="edit" action="#{benutzerverwaltungsBean.editUser(user)}" update=":userDialogForm:userDlgGrid" oncomplete="PF('udlg1').show();"/>
                </p:column>

            </p:dataTable>

            <p:commandButton id="newUserBut" value="New User" action="#{benutzerverwaltungsBean.newUser}" update=":userDialogForm:userDlgGrid :weekDialogForm:weekDlgPanel"  oncomplete="PF('udlg1').show();"/>

        </h:form>

        <p:dialog  closeOnEscape="true" header="User Dialog" widgetVar="udlg1" modal="true" resizable="false">
            <h:form id="userDialogForm">
                <p:panelGrid id="userDlgGrid">
                    <p:row>
                        <p:column><p:outputLabel value="Accesslevel "/></p:column>
                        <p:column><p:selectOneMenu value="#{benutzerverwaltungsBean.selectedUser.accessLevel}">
                                <f:selectItems value="#{benutzerverwaltungsBean.accessGroups}" var="ag" itemLabel="#{ag.accessLevelName}" itemValue="#{ag}"/>
                                <f:converter converterId="accesslevelconv"/>
                            </p:selectOneMenu></p:column>
                    </p:row>

                    <p:row>
                        <p:column><p:outputLabel value="Username: "/></p:column>
                        <p:column><p:inputText value="#{benutzerverwaltungsBean.selectedUser.username}"/></p:column>
                    </p:row>

                    <p:row>
                        <p:column><p:outputLabel value="Password: "/></p:column>
                        <p:column><p:inputText type="password" value="#{benutzerverwaltungsBean.selectedUser.pass}" /></p:column>
                    </p:row>

                    <p:row>
                        <p:column><p:outputLabel value="Vorname Nachname: "/></p:column>
                        <p:column><p:inputText value="#{benutzerverwaltungsBean.selectedUser.persName}"/></p:column>
                    </p:row>

                    <p:row>
                        <p:column><p:outputLabel value="E-Mail-Adresse: "/></p:column>
                        <p:column><p:inputText value="#{benutzerverwaltungsBean.selectedUser.email}"/></p:column>
                    </p:row>

                    <p:row>
                        <p:column><p:outputLabel value="Hiredate: "/></p:column>
                        <p:column><p:calendar value="#{benutzerverwaltungsBean.selectedUser.hiredate}" mask="true" pattern="dd.MM.yyyy" converter="localDateConverter"/></p:column>
                    </p:row>

                    <p:row>
                        <p:column><p:outputLabel value="Vacation Left: "/></p:column>
                        <p:column><p:inputText type="number" value="#{benutzerverwaltungsBean.selectedUser.vacationLeft}" /></p:column>
                    </p:row>

                    <p:row>
                        <p:column><p:outputLabel value="Overtime Left: "/></p:column>
                        <p:column><p:inputText type="number" value="#{benutzerverwaltungsBean.selectedUser.overTimeLeft}" converter="minuteHourConverter"/></p:column>
                    </p:row>

                    <p:row>
                        <p:column><p:outputLabel value="Weektime: "/></p:column>
                        <p:column><p:commandButton id="weektimeBut"  value="change WeekTime" action="#{benutzerverwaltungsBean.loadSollZeiten}" update=":weekDialogForm:weekDlgPanel"  oncomplete="PF('uwtdlg').show();"/></p:column>
                        <!--<p:column><p:inputMask id="weektimeIn"  mask="99.9" value="#{benutzerverwaltungsBean.selectedUser.weekTime}"/></p:column>-->
                    </p:row>

                    <p:row>
                        <p:column colspan="2"><p:selectBooleanButton value="#{benutzerverwaltungsBean.selectedUser.disabled}"  onLabel="Disabled" offLabel="Enabled"/></p:column>
                    </p:row>

                    <f:facet name="footer">
                        <p:row>
                            <p:column><p:commandButton value="User speichern" action="#{benutzerverwaltungsBean.saveUser}" update=":tableForm:usertable" oncomplete="PF('udlg1').hide();"/></p:column>
                            <p:column><p:commandButton value="Änderung verwerfen" action="#{benutzerverwaltungsBean.discardUserChanges}" oncomplete="PF('udlg1').hide();"/></p:column>
                        </p:row>
                    </f:facet>
                </p:panelGrid>
            </h:form>
        </p:dialog>   

        <p:dialog widgetVar="uwtdlg" closeOnEscape="true" header="WeekTime Dialog" modal="true" maximizable="true" height="750" width="1000" dynamic="true">
            <h:form id="weekDialogForm">
                <p:panel  id="weekDlgPanel">

                    <p:schedule minTime="6" maxTime="21" id="weektimeSchedule" timeZone="GMT+2"  draggable="false" allDaySlot="false" showHeader="false"  columnFormat="" view="agendaWeek" 
                                timeFormat="HH:mm" axisFormat="HH:mm" locale="de"  ignoreTimezone="true" value="#{benutzerverwaltungsBean.timeModel}">

                        <p:ajax event="dateSelect" listener="#{benutzerverwaltungsBean.onDateSelect}" update=":weekTimeSelectForm:eventDetails sollZeitText" oncomplete="PF('eventDialog').show();" />
                        <p:ajax event="eventSelect" listener="#{benutzerverwaltungsBean.onEventSelect}" update=":weekTimeSelectForm:eventDetails" oncomplete="PF('eventDialog').show();" />
                        <p:ajax event="eventResize" listener="#{benutzerverwaltungsBean.onEventResize}" update="sollZeitText"/>

                    </p:schedule>
                    <f:facet name="footer">
                        <p:commandButton value="Zeiten speichern" action="#{benutzerverwaltungsBean.saveTimes}" oncomplete="PF('uwtdlg').hide();"/>
                        <p:commandButton value="Änderung verwerfen" action="#{benutzerverwaltungsBean.discardTimes}" oncomplete="PF('uwtdlg').hide();"/>
                        <p:outputLabel value="Gesamte Sollzeit:" />
                        <p:inputText id="sollZeitText" value="#{benutzerverwaltungsBean.newWeekTime}" readonly="true"/>

                    </f:facet>
                </p:panel>            
            </h:form>
        </p:dialog>

        <p:dialog widgetVar="eventDialog" showEffect="clip" hideEffect="clip" closeOnEscape="true" resizable="false" dynamic="true">
            <h:form id="weekTimeSelectForm">
                <h:panelGrid id="eventDetails" columns="2">

                    <p:outputLabel for="from" value="From:" />
                    <p:calendar id="from" value="#{benutzerverwaltungsBean.curEvent.startDate}" pattern="HH:mm" pagedate="1/8/16" timeOnly="true" locale="de"/>

                    <p:outputLabel for="to" value="To:" />
                    <p:calendar id="to" value="#{benutzerverwaltungsBean.curEvent.endDate}" pattern="HH:mm" pagedate="1/8/16" timeOnly="true" locale="de"/>

                    <p:commandButton type="reset" value="Reset" />
                    <p:commandButton id="addButton" value="Save" action="#{benutzerverwaltungsBean.addEvent}" update=":weekDialogForm:weektimeSchedule :weekDialogForm:sollZeitText"  oncomplete="PF('eventDialog').hide();" />
                </h:panelGrid>
            </h:form>
        </p:dialog> 

        <script type="text/javascript">
            PrimeFaces.locales['de'] = {
                month: 'Monat',
                week: 'Woche',
                day: 'Tag',
                firstDay: 1,
                monthNames: ['Januar', 'Februar', 'März', 'April', 'Mai', 'Juni', 'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'],
                monthNamesShort: ['Jan', 'Feb', 'Mrz', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez'],
                dayNames: ['Sonntag', 'Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag'],
                dayNamesShort: ['So', 'Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa'],
                dayNamesMin: ['S', 'M', 'D', 'M ', 'D', 'F ', 'S'],
                currentText: 'Heute'
            };
        </script>

    </ui:define>
</ui:composition>
